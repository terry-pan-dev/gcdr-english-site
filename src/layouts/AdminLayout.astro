---
// Import CSS - Astro automatically injects the CSS link tag in the head
// This works the same way as BaseLayout.astro
import '../styles/globals.css';

interface Props {
  title?: string;
}

const { title = 'Admin - GCDR' } = Astro.props;
---

<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <slot name="head" />
    <!-- Client-side CSS loader for client-only pages -->
    <script is:inline>
      // Ensure CSS is loaded for client-side rendered pages
      (function() {
        if (typeof window !== 'undefined') {
          const loadCSS = () => {
            // Find base path
            let basePath = window.location.origin;
            const scripts = Array.from(document.querySelectorAll('script[src*="_astro"]'));
            if (scripts.length > 0) {
              basePath = scripts[0].src.split('/_astro/')[0];
            }

            // Check if dashboard CSS is already loaded
            const existingLinks = Array.from(document.querySelectorAll('link[rel="stylesheet"]'));
            const hasDashboardCSS = existingLinks.some(link => {
              const href = link.href;
              return href.includes('dashboard') && href.includes('_astro');
            });

            if (!hasDashboardCSS) {
              // Find dashboard CSS by trying hashes from script tags
              const scriptTags = Array.from(document.querySelectorAll('script[src*="_astro"]'));
              const loadedHrefs = new Set(existingLinks.map(link => link.href));

              // Try hashes from all scripts to find dashboard CSS
              scriptTags.forEach(script => {
                const src = script.src;
                const hashMatch = src.match(/\.([A-Za-z0-9]+)\.js/);
                if (hashMatch) {
                  const hash = hashMatch[1];
                  const cssHref = `${basePath}/_astro/dashboard.${hash}.css`;
                  if (!loadedHrefs.has(cssHref)) {
                    const link = document.createElement('link');
                    link.rel = 'stylesheet';
                    link.href = cssHref;
                    link.onerror = () => link.remove(); // Remove if file doesn't exist
                    document.head.appendChild(link);
                    loadedHrefs.add(cssHref);
                  }
                }
              });
            }
          };

          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadCSS);
          } else {
            loadCSS();
          }
        }
      })();
    </script>
  </head>
  <body class="h-full bg-background text-foreground antialiased">
    <slot />
  </body>
</html>

